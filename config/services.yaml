services:
    # Default configuration for services
    _defaults:
        autowire: true
        autoconfigure: true
        public: false

    # Make classes in src/ available for dependency injection
    Dradisic\KafkaSchema\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'

    # Schema Store configuration
    Dradisic\KafkaSchema\Schema\SchemaStore:
        arguments:
            $schemasDirectory: '%kernel.project_dir%/schemas'
            $cacheEnabled: true

    # Schema Metadata Manager
    Dradisic\KafkaSchema\Schema\SchemaMetadataManager:
        arguments:
            $schemaStore: '@Dradisic\KafkaSchema\Schema\SchemaStore'

    # Filesystem Schema Resolver
    Dradisic\KafkaSchema\Schema\Resolver\FilesystemSchemaResolver:
        arguments:
            $schemaStore: '@Dradisic\KafkaSchema\Schema\SchemaStore'

    # Schema Manager (main service)
    Dradisic\KafkaSchema\Service\SchemaManager:
        arguments:
            $schemaStore: '@Dradisic\KafkaSchema\Schema\SchemaStore'
            $metadataManager: '@Dradisic\KafkaSchema\Schema\SchemaMetadataManager'
            $logger: '@logger'

    # Interface binding
    Dradisic\KafkaSchema\Service\SchemaManagerInterface: '@Dradisic\KafkaSchema\Service\SchemaManager'

    # Commands
    Dradisic\KafkaSchema\Command\SchemaMigrationCommand:
        arguments:
            $schemaStore: '@Dradisic\KafkaSchema\Schema\SchemaStore'
            $metadataManager: '@Dradisic\KafkaSchema\Schema\SchemaMetadataManager'
            $schemaManager: '@Dradisic\KafkaSchema\Service\SchemaManagerInterface'
        tags:
            - { name: console.command }

    Dradisic\KafkaSchema\Command\SchemaListCommand:
        arguments:
            $schemaStore: '@Dradisic\KafkaSchema\Schema\SchemaStore'
            $metadataManager: '@Dradisic\KafkaSchema\Schema\SchemaMetadataManager'
        tags:
            - { name: console.command }

    Dradisic\KafkaSchema\Command\SchemaValidateCommand:
        arguments:
            $schemaManager: '@Dradisic\KafkaSchema\Service\SchemaManagerInterface'
        tags:
            - { name: console.command }

parameters:
    # Schema configuration
    schema.directory: '%kernel.project_dir%/schemas'
    schema.cache_enabled: true
    schema.cache_ttl: 3600